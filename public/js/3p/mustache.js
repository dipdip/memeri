/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */
(function(n,t){typeof exports=="object"&&exports?module.exports=t:typeof define=="function"&&define.amd?define(t):n.Mustache=t})(this,function(){function tt(n,t){return v.call(n,t)}function k(n){return!tt(d,n)}function e(n){return n.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function g(n){return String(n).replace(/[&<>"'\/]/g,function(n){return s[n]})}function u(n){this.string=n,this.tail=n,this.pos=0}function t(n,t){this.view=n,this.parent=t,this._cache={}}function i(){this.clearCache()}function f(t,i,r,u){for(var s="",h,c,e,l,y,v,a=0,p=t.length;a<p;++a){h=t[a],c=h[1];switch(h[0]){case"#":e=r.lookup(c);if(typeof e=="object")if(o(e))for(l=0,y=e.length;l<y;++l)s+=f(h[4],i,r.push(e[l]),u);else e&&(s+=f(h[4],i,r.push(e),u));else typeof e=="function"?(v=u==null?null:u.slice(h[3],h[5]),e=e.call(r.view,v,function(n){return i.render(n,r)}),e!=null&&(s+=e)):e&&(s+=f(h[4],i,r,u));break;case"^":e=r.lookup(c),(!e||o(e)&&e.length===0)&&(s+=f(h[4],i,r,u));break;case">":e=i.getPartial(c),typeof e=="function"&&(s+=e(r));break;case"&":e=r.lookup(c),e!=null&&(s+=e);break;case"name":e=r.lookup(c),e!=null&&(s+=n.escape(e));break;case"text":s+=c}}return s}function a(n){for(var f=[],u=f,i=[],t,e,r=0,o=n.length;r<o;++r){t=n[r];switch(t[0]){case"#":case"^":i.push(t),u.push(t),u=t[4]=[];break;case"/":e=i.pop(),e[5]=t[2],u=i.length>0?i[i.length-1][4]:f;break;default:u.push(t)}}return f}function y(n){for(var f=[],t,i,r=0,u=n.length;r<u;++r)t=n[r],t&&(t[0]==="text"&&i&&i[0]==="text"?(i[1]+=t[1],i[3]=t[3]):(i=t,f.push(t)));return f}function l(n){return[new RegExp(e(n[0])+"\\s*"),new RegExp("\\s*"+e(n[1]))]}var n={},o,s,r;n.name="mustache.js",n.version="0.7.2",n.tags=["{{","}}"],n.Scanner=u,n.Context=t,n.Writer=i;var b=/\s*/,c=/\s+/,d=/\S/,h=/\s*=/,p=/\s*\}/,w=/#|\^|\/|>|\{|&|=|!/,v=RegExp.prototype.test,nt=Object.prototype.toString;return o=Array.isArray||function(n){return nt.call(n)==="[object Array]"},s={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},n.escape=g,u.prototype.eos=function(){return this.tail===""},u.prototype.scan=function(n){var t=this.tail.match(n);return t&&t.index===0?(this.tail=this.tail.substring(t[0].length),this.pos+=t[0].length,t[0]):""},u.prototype.scanUntil=function(n){var i,t=this.tail.search(n);switch(t){case-1:i=this.tail,this.pos+=this.tail.length,this.tail="";break;case 0:i="";break;default:i=this.tail.substring(0,t),this.tail=this.tail.substring(t),this.pos+=t}return i},t.make=function(n){return n instanceof t?n:new t(n)},t.prototype.push=function(n){return new t(n,this)},t.prototype.lookup=function(n){var t=this._cache[n],i,u,r;if(!t){if(n==".")t=this.view;else{i=this;while(i){if(n.indexOf(".")>0){t=i.view,u=n.split("."),r=0;while(t&&r<u.length)t=t[u[r++]]}else t=i.view[n];if(t!=null)break;i=i.parent}}this._cache[n]=t}return typeof t=="function"&&(t=t.call(this.view)),t},i.prototype.clearCache=function(){this._cache={},this._partialCache={}},i.prototype.compile=function(t,i){var r=this._cache[t],u;return r||(u=n.parse(t,i),r=this._cache[t]=this.compileTokens(u,t)),r},i.prototype.compilePartial=function(n,t,i){var r=this.compile(t,i);return this._partialCache[n]=r,r},i.prototype.getPartial=function(n){return n in this._partialCache||!this._loadPartial||this.compilePartial(n,this._loadPartial(n)),this._partialCache[n]},i.prototype.compileTokens=function(n,i){var r=this;return function(u,e){if(e)if(typeof e=="function")r._loadPartial=e;else for(var o in e)r.compilePartial(o,e[o]);return f(n,r,t.make(u),i)}},i.prototype.render=function(n,t,i){return this.compile(n)(t,i)},n.parse=function(t,i){function st(){if(et&&!tt)while(ut.length)delete d[ut.pop()];else ut=[];et=!1,tt=!1}var s,f,o,rt,ft,it,ot,g;t=t||"",i=i||n.tags,typeof i=="string"&&(i=i.split(c));if(i.length!==2)throw new Error("Invalid tags: "+i.join(", "));var v=l(i),r=new u(t),nt=[],d=[],ut=[],et=!1,tt=!1;while(!r.eos()){s=r.pos,o=r.scanUntil(v[0]);if(o)for(it=0,ot=o.length;it<ot;++it)rt=o.charAt(it),k(rt)?ut.push(d.length):tt=!0,d.push(["text",rt,s,s+1]),s+=1,rt=="\n"&&st();if(!r.scan(v[0]))break;et=!0,f=r.scan(w)||"name",r.scan(b),f==="="?(o=r.scanUntil(h),r.scan(h),r.scanUntil(v[1])):f==="{"?(o=r.scanUntil(new RegExp("\\s*"+e("}"+i[1]))),r.scan(p),r.scanUntil(v[1]),f="&"):o=r.scanUntil(v[1]);if(!r.scan(v[1]))throw new Error("Unclosed tag at "+r.pos);ft=[f,o,s,r.pos],d.push(ft);if(f==="#"||f==="^")nt.push(ft);else if(f==="/"){if(nt.length===0)throw new Error('Unopened section "'+o+'" at '+s);g=nt.pop();if(g[1]!==o)throw new Error('Unclosed section "'+g[1]+'" at '+s);}else if(f==="name"||f==="{"||f==="&")tt=!0;else if(f==="="){i=o.split(c);if(i.length!==2)throw new Error("Invalid tags at "+s+": "+i.join(", "));v=l(i)}}g=nt.pop();if(g)throw new Error('Unclosed section "'+g[1]+'" at '+r.pos);return d=y(d),a(d)},r=new i,n.clearCache=function(){return r.clearCache()},n.compile=function(n,t){return r.compile(n,t)},n.compilePartial=function(n,t,i){return r.compilePartial(n,t,i)},n.compileTokens=function(n,t){return r.compileTokens(n,t)},n.render=function(n,t,i){return r.render(n,t,i)},n.to_html=function(t,i,r,u){var f=n.render(t,i,r);if(typeof u=="function")u(f);else return f},n}())